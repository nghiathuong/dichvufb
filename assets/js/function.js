$(document).ready(function () { $.ajaxSetup({ headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content') } }); $('form[request-ajax="LBD"]').submit(function (e) { e.preventDefault(); var url = $(this).attr('action'); var method = $(this).attr('method'); var href = $(this).attr('href'); var data = $(this).serialize(); var type = $(this).attr('call'); var token = $('meta[name="csrf-token"]').attr('content'); data += '&_token=' + token; var button = $(this).find('button[type="submit"]'); if (button.attr("confirm")) { Swal.fire({ title: 'Xác nhận thao tác?', text: button.attr("confirm"), icon: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Xác nhận', }).then((result) => { if (result.isConfirmed) { submitFormData(url, href, method, data, button, type); } }); } else { submitFormData(url, href, method, data, button, type); } }); }); function submitFormData(url, href, method, data, button, type) { let config = { url: url, type: method, data: data, dataType: 'json', beforeSend: function () { button.html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...').attr('disabled', 'disabled'); }, complete: function () { button.html('Xác nhận').removeAttr('disabled'); }, success: function (response) { if (type == 'request') { if (response.code == 200) { $('#message').html(' <div class="alert alert-success" role="alert"> <button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="true">×</button> <i class="fa fa-frown-o me-2" aria-hidden="true"></i>' + response.message + '</div>'); setTimeout(function () { if (href) { window.location.href = href; }else if(href == 'load'){location.reload();} else { window.location.reload(); } }, 2000); } else { $('#message').html(' <div class="alert alert-danger" role="alert"> <button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="true">×</button> <i class="fa fa-smile-o me-2" aria-hidden="true"></i>' + response.message + '</div>'); } } else if (type == 'swal') { if (response.code == 200) { Swal.fire('Thành công', response.message, 'success'); setTimeout(function () { window.location.href = href; }, 2000); } else { Swal.fire('Thất bại', response.message, 'error'); } } }, error: function (error) { console.log(error); }, }; $.ajax(config); }

$.cookie('the_cooke', null)